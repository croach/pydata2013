<!DOCTYPE html>
<html>
<head>
    <title>Congressional Gridlock</title>
    <script src="d3.v3.js" charset="utf-8"></script>
    <style type="text/css">
    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }

    #tooltip {
        position: absolute;
        width: 200px;
        height: auto;
        padding: 10px;
        background-color: black;
        opacity: 0.9;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        pointer-events: none;
    }

    #tooltip.hidden {
        display: none;
    }

    #tooltip p {
        margin: 0;
        font-family: sans-serif;
        font-size: 16px;
        line-height: 20px;
        color: white;
    }
    </style>
</head>
<body>
    <svg id="barchart"></svg>
    <p id="add">Add a new data value</p>
    <p id="remove">Remove a data value</p>

    <br /><br /><br /><br /><br />

    <div id="tooltip" class="hidden">
        <p><strong>Important Label Heading</strong></p>
        <p><span id="value">100</span>%</p>
    </div>

<!--     <p>Click on this text to update the chart with new data values.</p>
    <svg id="scatterplot"></svg>
 -->

    <script type="text/javascript">

    /* Bar Chart */

    var w = 600;
    var h = 250;
    var barPadding = 1;
    var maxValue = 25;

    var dataset = [ { key: 0, value: 5 },
                    { key: 1, value: 10 },
                    { key: 2, value: 13 },
                    { key: 3, value: 19 },
                    { key: 4, value: 21 },
                    { key: 5, value: 25 },
                    { key: 6, value: 22 },
                    { key: 7, value: 18 },
                    { key: 8, value: 15 },
                    { key: 9, value: 13 },
                    { key: 10, value: 11 },
                    { key: 11, value: 12 },
                    { key: 12, value: 15 },
                    { key: 13, value: 20 },
                    { key: 14, value: 18 },
                    { key: 15, value: 17 },
                    { key: 16, value: 16 },
                    { key: 17, value: 18 },
                    { key: 18, value: 23 },
                    { key: 19, value: 25 } ];

    var key = function(d) {
        return d.key;
    }

    var xScale = d3.scale.ordinal()
                   .domain(d3.range(dataset.length))
                   .rangeRoundBands([0, w], 0.05);

    var yScale = d3.scale.linear()
                   .domain([0, d3.max(dataset, function(d) { return d.value; })])
                   .range([0, h]);

    var svg = d3.select("svg#barchart")
                .attr("width", w)
                .attr("height", h);

    var sortBars = (function() {
        var ascending = false;
        return function() {
            ascending = !ascending;
            svg.selectAll("rect")
               .sort(function(a, b) {
                    if (ascending) {
                        return d3.ascending(a.value, b.value);
                    } else {
                        return d3.descending(a.value, b.value);
                    }
               })
               .transition()
               .delay(function(d, i) {
                    return i * 50;
               })
               .duration(1000)
               .attr("x", function(d, i) {
                    return xScale(i);
               });

            // svg.selectAll("text")
            //    .sort(function(a, b) {
            //         if (ascending) {
            //             return d3.ascending(a.value, b.value);
            //         } else {
            //             return d3.descending(a.value, b.value);
            //         }
            //    })
            //    .transition()
            //    .delay(function(d, i) {
            //         return i * 50;
            //    })
            //    .duration(1000)
            //    .attr("x", function(d, i) {
            //         return xScale(i) + xScale.rangeBand() / 2;
            //    });
        }
    })();

    svg.selectAll("rect")
        .data(dataset, key)
        .enter()
        .append("rect")
        .attr("x", function(d, i) {
            return xScale(i);
        })
        .attr("y", function(d) {
            return h - yScale(d.value);
        })
        .attr("width", xScale.rangeBand())
        .attr("height", function(d) {
            return yScale(d.value);
        })
        .attr("fill", function(d) {
            return "rgb(0, 0, " + (d.value * 10) + ")";
        })
        .on("mouseover", function(d) {
            var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
            var yPosition = parseFloat(d3.select(this).attr("y")) / 2 + h / 2;

            d3.select("#tooltip")
              .style("left", xPosition + "px")
              .style("top", yPosition + "px")
              .select("#value")
              .text(d.value);

            d3.select("#tooltip").classed("hidden", false);

            d3.select(this)
              .attr("fill", "orange");
        })
        .on("mouseout", function(d) {
            d3.select("#tooltip").classed("hidden", true);

            d3.select(this)
              .transition()
              .duration(250)
              .attr("fill", "rgb(0, 0, " + (d.value * 10) + ")");
        })
        .on("click", sortBars)
        .append("title")
        .text(function(d) {
            return "This value is " + d.value;
        });

    // svg.selectAll("text")
    //    .data(dataset, key)
    //    .enter()
    //    .append("text")
    //    .text(function(d) {
    //      return d.value;
    //    })
    //    .attr("x", function(d, i) {
    //      return xScale(i) + xScale.rangeBand() / 2;
    //    })
    //    .attr("y", function(d, i) {
    //      return h - yScale(d.value) + 15;
    //    })
    //    .attr("font-family", "sans-serif")
    //    .attr("font-size", "11px")
    //    .attr("fill", "white")
    //    .attr("text-anchor", "middle")
    //    .style("pointer-events", "none");

    d3.selectAll("p")
      .on("click", function() {
        var duration = 500;

        var paragraphID = d3.select(this).attr("id");

        if (paragraphID == "add") {
            /* Add a new number to the dataset */
            var newKey = dataset[dataset.length - 1].key + 1;
            var newValue = Math.floor(Math.random() * maxValue);
            dataset.push({ key: newKey, value: newValue });
        } else {
            /* Remove a number from the dataset */
            dataset.shift();
        }

        /* Randomly update all numbers in the dataset */
        // for (var i = 0; i < dataset.length; i++) {
        //     dataset[i] = Math.floor(Math.random() * maxValue);
        // };
        // yScale.domain([0, d3.max(dataset)]);

        xScale.domain(d3.range(dataset.length));
        yScale.domain([0, d3.max(dataset, function(d) { return d.value; })]);

        var bars = svg.selectAll("rect")
                      .data(dataset, key);

        bars.enter()
            .append("rect")
            .attr("x", w)
            .attr("y", function(d) {
                return h - yScale(d.value);
            })
            .attr("width", xScale.rangeBand())
            .attr("height", function(d) {
                return yScale(d.value);
            })
            .attr("fill", function(d) {
                return "rgb(0, 0, " + (d.value * 10) + ")";
            });


        bars.transition()
            .delay(function(d, i) {
                return i / dataset.length * 1000;
            })
            .duration(duration)
            .attr("x", function(d, i) {
                return xScale(i)
            })
            .attr("y", function(d) {
                return h - yScale(d.value);
            })
            .attr("width", xScale.rangeBand())
            .attr("height", function(d) {
                return yScale(d.value);
            })
            .attr("fill", function(d) {
                return "rgb(0, 0, " + (d.value * 10) + ")";
            });

        bars.exit()
            .transition()
            .duration(duration)
            .attr("x", -xScale.rangeBand())
            .remove();

        // var labels = svg.selectAll("text")
        //                 .data(dataset, key);

        // labels.enter()
        //       .append("text")
        //       .text(function(d) {
        //         return d.value;
        //       })
        //       .attr("x", w)
        //       .attr("y", function(d, i) {
        //         return h - yScale(d.value) + 15;
        //       })
        //      .attr("font-family", "sans-serif")
        //      .attr("font-size", "11px")
        //      .attr("fill", "white")
        //      .attr("text-anchor", "middle");


        // labels.transition()
        //       .delay(function(d, i) {
        //         return i / dataset.length * 1000;
        //       })
        //       .duration(duration)
        //       .text(function(d) {
        //         return d.value;
        //       })
        //       .attr("x", function(d, i) {
        //         return xScale(i) + xScale.rangeBand() / 2;
        //       })
        //       .attr("y", function(d, i) {
        //         return h - yScale(d.value) + 15;
        //       });

        // labels.exit()
        //       .transition()
        //       .duration(duration)
        //       .attr("x", -xScale.rangeBand())
        //       .remove();

      });


    /* Scatterplot */

    // var w = 500;
    // var h = 300;

    // var dataset = [];
    // var numDataPoints = 50;
    // var xRange = Math.random() * 1000;
    // var yRange = Math.random() * 1000;
    // for (var i = 0; i < numDataPoints; i++) {
    //     var randX = Math.round(Math.random() * xRange);
    //     var randY = Math.round(Math.random() * yRange);
    //     dataset.push([randX, randY]);
    // };

    // var padding = 30;

    // var xScale = d3.scale.linear()
    //                .domain([0, d3.max(dataset, function(d) { return d[0]; })])
    //                .range([padding, w - padding * 2]);

    // var xAxis = d3.svg.axis()
    //               .scale(xScale)
    //               .orient("bottom")
    //               .ticks(5);

    // var yScale = d3.scale.linear()
    //                .domain([0, d3.max(dataset, function(d) { return d[1]; })])
    //                .range([h - padding, padding]);

    // var yAxis = d3.svg.axis()
    //               .scale(yScale)
    //               .orient("left")
    //               .ticks(5);

    // var rScale = d3.scale.linear()
    //                .domain([0, d3.max(dataset, function(d) { return d[1]; })])
    //                .range([2, 5]);

    // var svg = d3.select("svg#scatterplot")
    //             .attr("width", w)
    //             .attr("height", h);


    // svg.append("clipPath")
    //    .attr("id", "chart-area")
    //    .append("rect")
    //    .attr("x", padding)
    //    .attr("y", 0)
    //    .attr("width", w - padding)
    //    .attr("height", h - padding);

    // svg.append("g")
    //    .attr("id", "circles")
    //    .attr("clip-path", "url(#chart-area)")
    //    .selectAll("circle")
    //    .data(dataset)
    //    .enter()
    //    .append("circle")
    //    .attr("cx", function(d) {
    //      return xScale(d[0]);
    //    })
    //    .attr("cy", function(d) {
    //      return yScale(d[1]);
    //    })
    //    .attr("r", function(d) {
    //     return rScale(d[1]);
    //    });

    // svg.append("g")
    //    .attr("class", "x axis")
    //    .attr("transform", "translate(0," + (h - padding) + ")")
    //    .call(xAxis);

    // svg.append("g")
    //    .attr("class", "y axis")
    //    .attr("transform", "translate(" + padding + ",0)")
    //    .call(yAxis);

    // d3.select("p")
    //   .on("click", function() {
    //     var xRange = Math.random() * 1000;
    //     var yRange = Math.random() * 1000;
    //     for (var i = 0; i < dataset.length; i++) {
    //         var randX = Math.round(Math.random() * xRange);
    //         var randY = Math.round(Math.random() * yRange);
    //         dataset[i] = [randX, randY];
    //     };

    //     xScale.domain([0, d3.max(dataset, function(d) { return d[0]; })]);
    //     yScale.domain([0, d3.max(dataset, function(d) { return d[1]; })]);
    //     rScale.domain([0, d3.max(dataset, function(d) { return d[1]; })]);

    //     svg.selectAll("circle")
    //        .data(dataset)
    //        .attr("fill", "magenta")
    //        .attr("r", 7)
    //        .transition()
    //        .duration(1000)
    //        .attr("cx", function(d) {
    //          return xScale(d[0]);
    //        })
    //        .attr("cy", function(d) {
    //          return yScale(d[1]);
    //        })
    //        .attr("r", function(d) {
    //         return rScale(d[1]);
    //        })
    //        .transition()
    //        .duration(1000)
    //        .attr("fill", "black")
    //        .attr("r", 2);


    //     svg.select(".x.axis")
    //        .transition()
    //        .duration(1000)
    //        .call(xAxis);

    //     svg.select(".y.axis")
    //        .transition()
    //        .duration(1000)
    //        .call(yAxis);
    //   });

    </script>
</body>
</html>

